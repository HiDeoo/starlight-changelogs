---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro'
import { render } from 'astro:content'

import { getLink } from '../libs/link'
import { getVersionPath, getVersionsPath, type CompareProps } from '../libs/routing'
import { getChangelogTitle } from '../libs/title'

import Toolbar from './Toolbar.astro'

type Props = CompareProps

const { changelog, entries, entry, locale, versions } = Astro.props

// TODO(HiDeoo) refactor date in component
---

<StarlightPage
  frontmatter={{
    next: entry.compare.pagination.next,
    pagefind: changelog.pagefind,
    prev: entry.compare.pagination.prev,
    // TODO(HiDeoo)
    title: getChangelogTitle(changelog, locale),
  }}
  headings={entries.map((entry) => ({ depth: 2, slug: entry.data.slug, text: entry.data.title }))}
>
  <Toolbar backLink={getLink(getVersionsPath(changelog, locale))} {versions} />
  {
    entries.map(async (entry) => {
      const { Content } = await render(entry)

      return (
        <>
          <h2 id={entry.data.slug}>
            <a href={getLink(getVersionPath(entry, locale))}>{entry.data.title}</a>
          </h2>
          {entry.data.date && (
            <time datetime={entry.data.date.toISOString()}>
              {Astro.locals.t('starlightChangelogs.version.date', { date: entry.data.date })}
            </time>
          )}
          <Content />
        </>
      )
    })
  }
</StarlightPage>
